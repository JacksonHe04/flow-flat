# Flow Flat - å¯è§†åŒ–èŠ‚ç‚¹æµç¨‹å›¾å¼€å‘å¹³å°

ä¸€ä¸ªé›†æˆäº†èŠ‚ç‚¹æµç¨‹å›¾ã€å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ã€ä»£ç ç¼–è¾‘å™¨ä¸‰å¤§æ ¸å¿ƒåŠŸèƒ½æ¨¡å—çš„ç»¼åˆå¼€å‘å¹³å°ï¼ŒåŸºäºè‡ªç ”çš„ `custom-react-flow-node` ç»„ä»¶åº“æ„å»ºã€‚

## ğŸš€ é¡¹ç›®æ¦‚è¿°

Flow Flat æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„å¯è§†åŒ–å¼€å‘å¹³å°ï¼Œæä¾›äº†å®Œæ•´çš„èŠ‚ç‚¹æµç¨‹å›¾è§£å†³æ–¹æ¡ˆã€‚é¡¹ç›®é‡‡ç”¨ monorepo æ¶æ„ï¼ŒåŒ…å«è‡ªç ”çš„ React Flow èŠ‚ç‚¹ç»„ä»¶åº“å’ŒåŸºäºè¯¥ç»„ä»¶åº“çš„ Web åº”ç”¨å¹³å°ã€‚

### æ ¸å¿ƒç‰¹æ€§

- ğŸ¨ **è‡ªç ”èŠ‚ç‚¹ç»„ä»¶åº“**: å®Œå…¨è‡ªä¸»å¼€å‘çš„ `custom-react-flow-node` åŒ…
- ğŸ”§ **å®Œæ•´ TypeScript æ”¯æŒ**: ç±»å‹å®‰å…¨çš„å¼€å‘ä½“éªŒ
- ğŸ¯ **å¤šåŠŸèƒ½é›†æˆ**: èŠ‚ç‚¹æµç¨‹å›¾ + å¯Œæ–‡æœ¬ç¼–è¾‘ + ä»£ç ç¼–è¾‘
- ğŸ”Œ **é«˜åº¦å¯æ‰©å±•**: æ”¯æŒè‡ªå®šä¹‰èŠ‚ç‚¹ç±»å‹æ³¨å†Œ
- ğŸ“¦ **è½»é‡çº§è®¾è®¡**: æœ€å°åŒ–ä¾èµ–ï¼Œé«˜æ€§èƒ½è¡¨ç°
- ğŸª **ä¸°å¯Œç»„ä»¶**: å†…ç½®å¤šç§èŠ‚ç‚¹ç±»å‹å’Œç¼–è¾‘å™¨ç»„ä»¶

## ğŸ“ é¡¹ç›®ç»“æ„

```
flow-flat/
â”œâ”€â”€ package-custom-react-flow-node/    # è‡ªç ”èŠ‚ç‚¹ç»„ä»¶åº“
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/                 # æ ¸å¿ƒç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ Node.tsx               # é€šç”¨èŠ‚ç‚¹ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ NodeContainer.tsx      # èŠ‚ç‚¹å®¹å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ NodeHeader.tsx         # èŠ‚ç‚¹å¤´éƒ¨
â”‚   â”‚   â”‚   â”œâ”€â”€ NodeStoreAdapter.tsx   # çŠ¶æ€é€‚é…å™¨
â”‚   â”‚   â”‚   â””â”€â”€ TextNode.tsx           # æ–‡æœ¬èŠ‚ç‚¹
â”‚   â”‚   â””â”€â”€ types/                     # ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ dist/                          # æ„å»ºè¾“å‡º
â”œâ”€â”€ flow-flat-app/                     # Web åº”ç”¨å¹³å°
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ Node/                  # èŠ‚ç‚¹ç³»ç»Ÿ
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ NodeLayout/        # åŸé¡¹ç›®èŠ‚ç‚¹å¸ƒå±€
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Nodes/             # å†…ç½®èŠ‚ç‚¹ç±»å‹
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ImportExport/      # å¯¼å…¥å¯¼å‡ºåŠŸèƒ½
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ custom-react-flow-node-test-demo/  # æœ¬åœ°åŒ…é›†æˆæ¼”ç¤º
â”‚   â”‚   â”‚   â”œâ”€â”€ Markdown/              # å¯Œæ–‡æœ¬ç¼–è¾‘å™¨æ¨¡å—
â”‚   â”‚   â”‚   â””â”€â”€ CodeEditor/            # ä»£ç ç¼–è¾‘å™¨æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ pages/                     # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ stores/                    # Zustand çŠ¶æ€ç®¡ç†
â”‚   â”‚   â””â”€â”€ utils/                     # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ ...
â””â”€â”€ docs/                              # é¡¹ç›®æ–‡æ¡£
```

## ğŸ¯ æ ¸å¿ƒæ¨¡å—

### 1. Custom React Flow Node ç»„ä»¶åº“

ä½äº `package-custom-react-flow-node/` ç›®å½•ï¼Œè¿™æ˜¯é¡¹ç›®çš„æ ¸å¿ƒç»„ä»¶åº“ï¼š

#### ä¸»è¦ç»„ä»¶
- **Node**: é€šç”¨èŠ‚ç‚¹ç»„ä»¶ï¼Œæ ¹æ®èŠ‚ç‚¹ç±»å‹åŠ¨æ€æ¸²æŸ“
- **TextNode**: å†…ç½®æ–‡æœ¬èŠ‚ç‚¹ï¼Œæ”¯æŒåŒå‡»ç¼–è¾‘
- **NodeContainer**: èŠ‚ç‚¹å®¹å™¨ï¼Œæä¾›ç»Ÿä¸€å¤–è§‚å’Œäº¤äº’
- **NodeHeader**: èŠ‚ç‚¹å¤´éƒ¨ï¼Œæ˜¾ç¤ºç±»å‹å’Œå¯ç¼–è¾‘æ ‡é¢˜
- **NodeStoreAdapter**: çŠ¶æ€é€‚é…å™¨ï¼Œé›†æˆå¤–éƒ¨çŠ¶æ€ç®¡ç†

#### æ ¸å¿ƒåŠŸèƒ½
- ğŸ¨ å¯å®šåˆ¶èŠ‚ç‚¹ç±»å‹å’Œæ ·å¼
- ğŸ”§ å®Œæ•´çš„ TypeScript æ”¯æŒ
- ğŸ¯ ç®€å•æ˜“ç”¨çš„ API è®¾è®¡
- ğŸ”Œ æ”¯æŒæ³¨å†Œè‡ªå®šä¹‰èŠ‚ç‚¹ç±»å‹
- ğŸ“¦ è½»é‡çº§ï¼Œæœ€å°åŒ–ä¾èµ–

### 2. Flow Flat Web åº”ç”¨

ä½äº `flow-flat-app/` ç›®å½•ï¼ŒåŸºäºç»„ä»¶åº“æ„å»ºçš„å®Œæ•´ Web åº”ç”¨ï¼š

#### èŠ‚ç‚¹æµç¨‹å›¾ç³»ç»Ÿ
- **åŸç”ŸèŠ‚ç‚¹æ”¯æŒ**: TextNodeã€CodeNodeã€ImageNodeã€MarkdownNodeã€TodoNode
- **è‡ªå®šä¹‰èŠ‚ç‚¹æ¼”ç¤º**: CustomCodeNodeã€CustomImageNode
- **é›†æˆæ–¹æ¡ˆ**: æä¾›å®Œæ•´çš„æœ¬åœ°åŒ…é›†æˆç¤ºä¾‹
- **å¯¼å…¥å¯¼å‡º**: æ”¯æŒæµç¨‹å›¾çš„ä¿å­˜å’ŒåŠ è½½

#### å¯Œæ–‡æœ¬ç¼–è¾‘å™¨æ¨¡å—
åŸºäº TipTap çš„å®Œæ•´å¯Œæ–‡æœ¬ç¼–è¾‘è§£å†³æ–¹æ¡ˆï¼š
- ğŸ“ å®Œæ•´ Markdown è¯­æ³•æ”¯æŒ
- ğŸ¨ æ‰€è§å³æ‰€å¾—ç¼–è¾‘ä½“éªŒ
- ğŸ’¾ è‡ªåŠ¨ä¿å­˜åŠŸèƒ½
- ğŸ¯ èŠ‚ç‚¹å†…åµŒå’Œé¡µé¢çº§ä¸¤ç§åœºæ™¯
- ğŸŒ™ äº®è‰²/æš—è‰²ä¸»é¢˜æ”¯æŒ

#### ä»£ç ç¼–è¾‘å™¨æ¨¡å—
åŸºäº Monaco Editor çš„ä¸“ä¸šä»£ç ç¼–è¾‘åŠŸèƒ½ï¼š
- ğŸ”¤ æ”¯æŒ 26+ ç§ç¼–ç¨‹è¯­è¨€è¯­æ³•é«˜äº®
- ğŸ§  æ™ºèƒ½ä»£ç è¡¥å…¨å’Œå»ºè®®
- ğŸ” å®æ—¶è¯­æ³•å’Œè¯­ä¹‰æ£€æŸ¥
- ğŸ¨ ä¸»é¢˜æ”¯æŒ
- âš™ï¸ é«˜åº¦å¯é…ç½®
- ğŸ“± å“åº”å¼è®¾è®¡

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- **æ¡†æ¶**: React + TypeScript
- **æ„å»ºå·¥å…·**: Vite + Rollup
- **çŠ¶æ€ç®¡ç†**: Zustand
- **èŠ‚ç‚¹æµç¨‹å›¾**: React Flow + custom-react-flow-node
- **å¯Œæ–‡æœ¬ç¼–è¾‘**: TipTap
- **ä»£ç ç¼–è¾‘å™¨**: Monaco Editor
- **æ ·å¼**: Tailwind CSS
- **åŒ…ç®¡ç†**: pnpm

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Node.js >= 16.0.0
- pnpm >= 7.0.0
- React >= 16.8.0
- @xyflow/react >= 12.0.0

### å®‰è£…å’Œè¿è¡Œ

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/JacksonHe04/flow-flat.git
cd flow-flat

# å®‰è£…ä¾èµ–
pnpm install

# æ„å»ºç»„ä»¶åº“
cd package-custom-react-flow-node
pnpm run build

# å¯åŠ¨ Web åº”ç”¨
cd ../flow-flat-app
pnpm run dev
```

### ä½¿ç”¨ç»„ä»¶åº“

```tsx
import React from 'react';
import { ReactFlow, Node as FlowNode } from '@xyflow/react';
import { Node, TextNode, BaseNodeData } from 'custom-react-flow-node';

// å®šä¹‰èŠ‚ç‚¹æ•°æ®ç±»å‹
interface MyNodeData extends BaseNodeData {
  title: string;
  content: string;
}

// åˆ›å»ºèŠ‚ç‚¹
const nodes: FlowNode<MyNodeData>[] = [
  {
    id: '1',
    type: 'custom',
    position: { x: 100, y: 100 },
    data: {
      nodeType: 'text',
      title: 'æˆ‘çš„èŠ‚ç‚¹',
      content: 'è¿™æ˜¯èŠ‚ç‚¹å†…å®¹'
    }
  }
];

// å®šä¹‰èŠ‚ç‚¹ç±»å‹
const nodeTypes = {
  custom: Node
};

function App() {
  return (
    <div style={{ height: '100vh' }}>
      <ReactFlow
        nodes={nodes}
        nodeTypes={nodeTypes}
      />
    </div>
  );
}

export default App;
```

## ğŸ“š ä½¿ç”¨åœºæ™¯

### 1. èŠ‚ç‚¹æµç¨‹å›¾å¼€å‘
- **ç‹¬ç«‹å¼€å‘æµ‹è¯•**: ä½¿ç”¨ DemoBoard ç‹¬ç«‹æµ‹è¯•æ–°èŠ‚ç‚¹ç±»å‹
- **é›†æˆéªŒè¯**: ä½¿ç”¨ TestBoard éªŒè¯ä¸åŸé¡¹ç›®çš„å…¼å®¹æ€§
- **ç”Ÿäº§æ›¿æ¢**: ä½¿ç”¨ NodeLayoutReplacement ç›´æ¥æ›¿æ¢åŸé¡¹ç›®çš„ NodeLayout
- **æ‰©å±•å¼€å‘**: å‚è€ƒè‡ªå®šä¹‰èŠ‚ç‚¹ç¤ºä¾‹å¼€å‘æ–°çš„èŠ‚ç‚¹ç±»å‹

### 2. å¯Œæ–‡æœ¬ç¼–è¾‘
- **æµç¨‹å›¾èŠ‚ç‚¹å†…å®¹ç¼–è¾‘**: è½»é‡çº§çš„èŠ‚ç‚¹å†…åµŒç¼–è¾‘å™¨
- **æ–‡æ¡£é¡µé¢ç¼–è¾‘**: å®Œæ•´çš„é¡µé¢çº§ç¼–è¾‘å™¨
- **è‡ªå®šä¹‰ç¼–è¾‘å™¨**: æ ¹æ®éœ€è¦è¿›è¡Œé…ç½®çš„ç¼–è¾‘å™¨

### 3. ä»£ç ç¼–è¾‘
- **ä»£ç èŠ‚ç‚¹ç¼–è¾‘**: åœ¨æµç¨‹å›¾èŠ‚ç‚¹ä¸­ç¼–è¾‘ä»£ç 
- **ç‹¬ç«‹ä»£ç ç¼–è¾‘**: ä¸“ä¸šçš„ä»£ç ç¼–è¾‘é¡µé¢
- **å¤šè¯­è¨€æ”¯æŒ**: æ”¯æŒä¸»æµç¼–ç¨‹è¯­è¨€çš„è¯­æ³•é«˜äº®

## ğŸ¨ è‡ªå®šä¹‰èŠ‚ç‚¹å¼€å‘

### åˆ›å»ºè‡ªå®šä¹‰èŠ‚ç‚¹

```tsx
import React from 'react';
import { CustomNodeProps, BaseNodeData, NodeContainer, NodeHeader } from 'custom-react-flow-node';

interface MyNodeData extends BaseNodeData {
  value: number;
}

const MyCustomNode: React.FC<CustomNodeProps<MyNodeData>> = ({ data, selected }) => {
  const handleValueChange = (newValue: number) => {
    if (data?.onDataChange) {
      data.onDataChange({ value: newValue });
    }
  };

  return (
    <NodeContainer selected={selected} onDelete={data?.onDelete}>
      <NodeHeader
        nodeType="custom"
        title={data?.title || 'è‡ªå®šä¹‰èŠ‚ç‚¹'}
        onTitleChange={(title) => data?.onDataChange?.({ title })}
      />
      <div>
        <input
          type="number"
          value={data?.value || 0}
          onChange={(e) => handleValueChange(Number(e.target.value))}
        />
      </div>
    </NodeContainer>
  );
};

export default MyCustomNode;
```

### æ³¨å†Œè‡ªå®šä¹‰èŠ‚ç‚¹

```tsx
import { registerNodeType } from 'custom-react-flow-node';
import MyCustomNode from './MyCustomNode';

// æ³¨å†ŒèŠ‚ç‚¹ç±»å‹
registerNodeType('myCustom', MyCustomNode);
```

## ğŸ”§ å¼€å‘ç‰¹æ€§

- **æ¨¡å—åŒ–æ¶æ„**: å„åŠŸèƒ½æ¨¡å—ç‹¬ç«‹å¼€å‘ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•
- **TypeScript æ”¯æŒ**: æä¾›å®Œæ•´çš„ç±»å‹å®šä¹‰ï¼Œæå‡å¼€å‘ä½“éªŒ
- **ç»„ä»¶å¤ç”¨**: æ„å»ºå¯å¤ç”¨çš„ç»„ä»¶åº“
- **å“åº”å¼è®¾è®¡**: é€‚é…ä¸åŒå±å¹•å°ºå¯¸å’Œè®¾å¤‡
- **çƒ­é‡è½½å¼€å‘**: åŸºäº Vite çš„å¿«é€Ÿå¼€å‘ä½“éªŒ
- **ä¸»é¢˜ç³»ç»Ÿ**: ç»Ÿä¸€çš„äº®è‰²/æš—è‰²ä¸»é¢˜æ”¯æŒ

## ğŸŒŸ æŠ€æœ¯äº®ç‚¹

1. **è‡ªç ”ç»„ä»¶åŒ…**: å®Œå…¨è‡ªä¸»å¼€å‘çš„ React Flow èŠ‚ç‚¹ç»„ä»¶åº“
2. **é€‚é…å™¨æ¨¡å¼**: é€šè¿‡ `NodeStoreAdapter` å®ç°ä¸ç°æœ‰ç³»ç»Ÿçš„æ— ç¼é›†æˆ
3. **æ¸è¿›å¼è¿ç§»**: æ”¯æŒä»åŸæœ‰ç³»ç»Ÿå¹³æ»‘è¿ç§»åˆ°æ–°çš„èŠ‚ç‚¹ç³»ç»Ÿ
4. **å¤šåœºæ™¯æ”¯æŒ**: åŒæ—¶æ”¯æŒèŠ‚ç‚¹å†…åµŒå’Œé¡µé¢çº§çš„ç¼–è¾‘åœºæ™¯
5. **å®Œæ•´çš„ç±»å‹æ”¯æŒ**: å…¨é¢çš„ TypeScript ç±»å‹å®šä¹‰
6. **é«˜åº¦å¯é…ç½®**: ä¸°å¯Œçš„é…ç½®é€‰é¡¹æ»¡è¶³ä¸åŒéœ€æ±‚

## ğŸ“– æ–‡æ¡£

- [ç»„ä»¶åº“ API æ–‡æ¡£](./package-custom-react-flow-node/README.md)
- [Web åº”ç”¨ä½¿ç”¨æŒ‡å—](./flow-flat-app/README.md)
- [å¼€å‘æ–‡æ¡£](./docs/)

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

### å¼€å‘æµç¨‹

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æ‰“å¼€ Pull Request

## ğŸ“„ è®¸å¯è¯

MIT License - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

## ğŸ‘¨â€ğŸ’» ä½œè€…

**Jackson He**
- GitHub: [@JacksonHe04](https://github.com/JacksonHe04)
- é¡¹ç›®é“¾æ¥: [https://github.com/JacksonHe04/flow-flat](https://github.com/JacksonHe04/flow-flat)

## ğŸ™ è‡´è°¢
